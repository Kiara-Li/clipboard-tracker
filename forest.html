<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>My Digital Forest</title>
    <style>
      /* --- åŸºç¡€å¸ƒå±€ --- */
      body {
        margin: 0;
        background-color: #1a1a1a;
        color: #ddd;
        font-family: sans-serif;
        height: 100vh;
        overflow: hidden;
      }

      /* --- å…³é”®ï¼šCanvas æ»šåŠ¨å®¹å™¨ --- */
      #canvas-container {
        width: 100%;
        height: 100vh;
        overflow-x: auto;
        overflow-y: hidden;
        position: relative;
        scrollbar-width: thin;
        scrollbar-color: #555 #1a1a1a;
      }
      #canvas-container::-webkit-scrollbar { height: 8px; }
      #canvas-container::-webkit-scrollbar-track { background: #1a1a1a; }
      #canvas-container::-webkit-scrollbar-thumb { background-color: #555; border-radius: 4px; }
      canvas { display: block; background: linear-gradient(to top, #1a1a1a 0%, #252525 100%); }

      /* --- æ–°å¢ï¼šå¤´éƒ¨åŒºåŸŸå®¹å™¨ (åŒ…å«æ ‡é¢˜å’Œä¸‹æ‹‰å¸®åŠ©) --- */
      #header-container {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 60; /* ä¿è¯åœ¨ Canvas ä¸Šæ–¹ */
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
        pointer-events: none; /* è®©å®¹å™¨æœ¬èº«ä¸æŒ¡é¼ æ ‡ï¼Œå­å…ƒç´ å¼€å¯ pointer-events */
      }

      h1 {
        font-weight: 300;
        color: rgba(255, 255, 255, 0.7);
        margin: 0;
        font-size: 24px;
        letter-spacing: 1px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        pointer-events: auto;
      }

      /* --- å¸®åŠ©è§¦å‘æŒ‰é’® (å°æ–‡å­—) --- */
      #help-trigger {
        background: none;
        border: none;
        color: #888;
        font-size: 13px;
        cursor: pointer;
        padding: 0;
        transition: color 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
        pointer-events: auto;
      }
      #help-trigger:hover { color: #4dabf7; }
      
      /* --- ä¸‹æ‹‰å¸®åŠ©é¢æ¿ (æ ¸å¿ƒåŠ¨ç”»æ ·å¼) --- */
      #help-panel {
        background: rgba(20, 20, 20, 0.9);
        backdrop-filter: blur(8px);
        border-left: 2px solid #444;
        margin-top: 5px;
        border-radius: 0 8px 8px 8px;
        pointer-events: auto;
        
        /* åŠ¨ç”»å…³é”®å±æ€§ */
        max-height: 0; /* é»˜è®¤å…³é—­ */
        overflow: hidden;
        opacity: 0;
        padding: 0 15px; /* å…³é—­æ—¶æ—  padding */
        width: 320px;
        transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      }

      /* æ‰“å¼€çŠ¶æ€ (ç”± JS æ·»åŠ è¿™ä¸ª class) */
      #help-panel.open {
        max-height: 500px; /* è¶³å¤Ÿå¤§çš„é«˜åº¦ */
        opacity: 1;
        padding: 15px; /* å±•å¼€æ—¶æ‰æœ‰ padding */
        border-color: #4dabf7;
      }

      /* é¢æ¿å†…æ–‡å­—æ ·å¼ */
      .help-intro { font-size: 13px; color: #ccc; margin-bottom: 15px; line-height: 1.5; font-style: italic; }
      .help-section { margin-bottom: 12px; }
      .help-title { font-size: 12px; font-weight: bold; color: #fff; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }
      .help-item { font-size: 12px; color: #999; margin-left: 10px; line-height: 1.6; display: flex; align-items: center; gap: 6px; }
      .help-icon { display: inline-block; width: 14px; text-align: center; font-weight: bold; }

      /* --- (æ–°å¢) å³ä¸Šè§’å¯¼å‡ºæŒ‰é’® --- */
      #export-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.4);
        border: 1px solid #555;
        color: #ccc;
        padding: 8px 15px;
        border-radius: 20px;
        cursor: pointer;
        z-index: 60;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.2s;
        font-size: 13px;
      }
      #export-btn:hover { background: #444; color: #fff; }

      /* --- è¯¦æƒ…æµ®å±‚ --- */
      #detail-overlay {
        display: none; 
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        width: 60%;
        max-width: 600px;
        max-height: 70vh;
        background: rgba(30, 30, 30, 0.95);
        border: 1px solid #555;
        border-radius: 8px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        padding: 20px;
        z-index: 100;
        overflow-y: auto;
        backdrop-filter: blur(5px);
      }

      .overlay-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #444; }
      .type-selector, .action-buttons { display: flex; align-items: center; gap: 10px; }
      .label { font-size: 12px; color: #888; margin-right: 5px; }
      
      /* æŒ‰é’®æ ·å¼ */
      .type-btn { width: 24px; height: 24px; border: 2px solid transparent; cursor: pointer; background-color: #555; transition: all 0.2s; padding: 0; box-sizing: border-box; }
      .type-btn:hover { transform: scale(1.1); filter: brightness(1.2); }
      .type-btn.active { border-color: #fff; box-shadow: 0 0 8px rgba(255,255,255,0.5); }
      .btn-code { background-color: #4dabf7; border-radius: 2px; }
      .btn-social { background-color: #ff6b6b; border-radius: 50%; }
      .btn-know { background-color: #ffe066; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); width: 26px; height: 26px; }

      #copy-text-btn { background: #333; color: #ddd; border: 1px solid #666; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
      #copy-text-btn:hover { background: #444; color: #fff; }
      #close-btn { font-size: 20px; cursor: pointer; color: #888; margin-left: 10px; font-weight: bold; }
      #close-btn:hover { color: #fff; }
      #visit-source-btn { background: #2b4a3c; color: #98c9a3; border: 1px solid #3d6e52; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-right: 8px; display: none; }
      #visit-source-btn:hover { background: #3d6e52; color: #fff; }
      
      /* (æ–°å¢) åˆ é™¤æŒ‰é’® */
      #delete-tree-btn { background: #4a2b2b; color: #e99; border: 1px solid #6e3d3d; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-left: 5px; font-size: 12px;}
      #delete-tree-btn:hover { background: #6e3d3d; color: #fff; }

      #detail-content { font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.6; color: #eee; white-space: pre-wrap; min-height: 50px; }

      /* --- æ—¥æœŸå¯¼èˆªæ  --- */
      #date-navigation {
        position: fixed;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 20px;
        background: rgba(0,0,0,0.4);
        padding: 10px 30px;
        border-radius: 30px;
        backdrop-filter: blur(4px);
        z-index: 50;
        border: 1px solid rgba(255,255,255,0.1);
      }
      #current-date-display { color: #fff; font-size: 16px; font-family: 'Courier New', monospace; font-weight: bold; min-width: 120px; text-align: center; }
      .nav-btn { background: none; border: 1px solid #666; color: #ddd; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; font-size: 14px; }
      .nav-btn:hover { background: #444; color: #fff; border-color: #888; }
      .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    </style>
  </head>
  <body>
    
    <div id="header-container">
        <h1>The Transplanted Forest</h1>
        
        <button id="help-trigger">
            ğŸŒ± How This Forest Works <span id="arrow-icon">â–¼</span>
        </button>

        <div id="help-panel">
            <p class="help-intro">
                Every time you copy text, you plant a new tree here.<br>
                Their shapes and sizes reflect your information habits.
            </p>
            
            <div class="help-section">
                <span class="help-title">â–  Shapes represent sources</span>
                <div class="help-item"><span class="help-icon" style="color:#4dabf7">â– </span> Squares are Code</div>
                <div class="help-item"><span class="help-icon" style="color:#ff6b6b">â—</span> Circles are Social</div>
                <div class="help-item"><span class="help-icon" style="color:#ffe066">â–²</span> Triangles are Other</div>
            </div>

            <div class="help-section">
                <span class="help-title">â–² Height reflects text length</span>
                <div class="help-item">Taller trees grow from longer fragments.</div>
            </div>

            <div class="help-section">
                <span class="help-title">ğŸ“… Navigate by day</span>
                <div class="help-item">Use arrows below to move through your forest.</div>
            </div>
            
            <div style="text-align: right; margin-top: 10px;">
                <button id="close-help-btn" style="background:none; border:none; color:#666; cursor:pointer; font-size:12px; text-decoration: underline;">Close</button>
            </div>
        </div>
    </div>
    
    <button id="export-btn" title="Save forest as image">ğŸ“· Export Image</button>

    <div id="canvas-container">
        <canvas id="forestCanvas"></canvas>
    </div>

    <div id="detail-overlay">
      <div class="overlay-toolbar">
        <div class="type-selector">
          <span class="label">Type:</span>
          <button class="type-btn btn-code" title="Code (Block)"></button>
          <button class="type-btn btn-social" title="Social (Circle)"></button>
          <button class="type-btn btn-know" title="Knowledge (Triangle)"></button>
        </div>

       <div class="action-buttons">
          <button id="visit-source-btn">ğŸŒ± Source</button>
          <button id="copy-text-btn">ğŸ“‹ Copy</button>
          <button id="delete-tree-btn" title="Remove tree">ğŸ—‘ï¸</button>
          <div id="close-btn">âœ•</div>
        </div>
      </div>
      <div id="detail-content">Loading...</div>
    </div>

    <div id="date-navigation">
        <button id="prev-day-btn" class="nav-btn">â—€</button>
        <span id="current-date-display">Loading...</span>
        <button id="next-day-btn" class="nav-btn">â–¶</button>
    </div>

    <script src="forest.js"></script>
  </body>
</html>